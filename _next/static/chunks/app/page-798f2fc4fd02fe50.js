(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1387:(e,t,n)=>{Promise.resolve().then(n.bind(n,9756))},6963:(e,t,n)=>{"use strict";n.d(t,{T:()=>s,z:()=>a});var s=function(e){return e.USER="user",e.USER_AUDIO="user_audio",e.SYSTEM="system",e}({}),a=function(e){return e.ENTER="Enter",e}({})},9756:(e,t,n)=>{"use strict";n.d(t,{default:()=>N});var s,a,l,c=n(5155),r=n(2115);class o{handleMessage(e,t){let n=t.data;if(n&&this.callbacks[e]){let t=this.callbacks[e];t&&"function"==typeof t&&t(n)}}constructor(){this.connections={},this.callbacks={},this.openConnection=(e,t,n)=>{if(this.connections[e])return void console.log("Websocket connection with id ".concat(e," already exists"));let s=new WebSocket(t);s.addEventListener("open",()=>{console.log("Websocket connection ".concat(e," opened"))}),s.addEventListener("error",t=>{console.log("Websocket error in connection ".concat(e,":"),t)}),s.addEventListener("message",t=>{this.handleMessage(e,t)}),s.addEventListener("close",()=>{console.log("Websocket connection ".concat(e," closed")),delete this.connections[e]}),this.connections[e]=s,this.callbacks[e]=n},this.closeConnection=e=>{let t=this.connections[e];t?t.close():console.log("No websocket connection found with id ".concat(e))},this.sendMessage=(e,t)=>{let n=this.connections[e];if(n&&n.readyState===WebSocket.OPEN)try{let e="string"==typeof t?t:JSON.stringify(t);n.send(e)}catch(t){console.error("Serialization error for message to ".concat(e,":"),t)}else console.log("Websocket connection ".concat(e," is not open or doesn't exist"))}}}let i=new o;var d=n(6963),u=n(873);let h=e=>{let t=(0,r.useRef)(null),n=(0,r.useRef)(null),s=()=>{var e;let{current:n}=t,s=null==n?void 0:n.osInstance();if(!s)return;let{scrollOffsetElement:a}=s.elements();a.scrollTo({top:null!=(e=a.scrollHeight)?e:0})};return(0,r.useEffect)(()=>{n.current&&s()},[e.children]),(0,c.jsx)(u.r,{ref:t,style:{height:"100%"},defer:!0,children:(0,c.jsx)("div",{ref:n,children:e.children})})},m=(0,r.memo)(function(e){let{message:t}=e;return(0,c.jsx)("div",{className:"text-center text-gray-500 text-sm my-4",children:t.content})});function f(){return(f=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(null,arguments)}let x=function(e){return r.createElement("svg",f({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 512 512"},e),s||(s=r.createElement("circle",{cx:256,cy:128,r:128})),a||(a=r.createElement("path",{d:"M256 298.667c-105.99.118-191.882 86.01-192 192C64 502.449 73.551 512 85.333 512h341.333c11.782 0 21.333-9.551 21.333-21.333-.117-105.99-86.009-191.883-191.999-192"})))},g=["bg-red-400","bg-green-400","bg-blue-400","bg-yellow-400","bg-pink-400","bg-indigo-400","bg-purple-400","bg-orange-400","bg-teal-400","bg-cyan-400"],p=e=>{let t=0;for(let n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);let n=Math.abs(t)%g.length;return g[n]},b=(0,r.memo)(function(e){let{message:t,userId:n}=e,s=(0,r.useMemo)(()=>p(t.author),[t.author]);return(0,c.jsx)(c.Fragment,{children:t.author===n?(0,c.jsx)("div",{className:"flex justify-end relative mb-5 gap-3",children:(0,c.jsx)("div",{className:"p-3 rounded-2xl bg-white max-w-lg shadow-md",children:t.type===d.T.USER?(0,c.jsx)("p",{className:"break-words",children:t.content}):(0,c.jsx)("audio",{src:t.content,controls:!0})})}):(0,c.jsxs)("div",{className:"flex gap-4 mb-5 items-start",children:[(0,c.jsx)("div",{className:"flex items-center justify-center shrink-0 ".concat(s," w-10 h-10 rounded-full overflow-hidden"),children:(0,c.jsx)(x,{className:"w-full h-full pt-1 fill-white"})}),(0,c.jsx)("div",{className:"p-3 rounded-2xl bg-white max-w-lg shadow-md",children:t.type===d.T.USER?(0,c.jsx)(c.Fragment,{children:t.content}):(0,c.jsx)("audio",{src:t.content,controls:!0})})]})})}),w=(0,r.memo)(function(e){let{message:t,userId:n}=e;switch(t.type){case d.T.SYSTEM:return(0,c.jsx)(m,{message:t});case d.T.USER||d.T.USER_AUDIO:default:return(0,c.jsx)(b,{message:t,userId:n})}}),v=e=>(0,c.jsx)(h,{children:(0,c.jsx)("ul",{className:"w-full md:w-7/12 mx-auto px-4 md:px-0 py-5",children:e.messages.map(t=>(0,c.jsx)("li",{children:(0,c.jsx)(w,{message:t,userId:e.userId})},"".concat(t.type).concat(t.timestamp).concat(t.author)))})});var j=n(5028);function y(){return(y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(null,arguments)}n(4971);let E=function(e){return r.createElement("svg",y({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24"},e),l||(l=r.createElement("path",{d:"M12 16a4 4 0 1 1 4-4 4 4 0 0 1-4 4m-6.317 0H1a1 1 0 0 1-1-1 6.02 6.02 0 0 1 5.131-5.916 1 1 0 0 1 1.1 1.266A6 6 0 0 0 6 12a5.9 5.9 0 0 0 .586 2.57 1 1 0 0 1-.9 1.43ZM17 24H7a1 1 0 0 1-1-1 6 6 0 0 1 12 0 1 1 0 0 1-1 1m1-16a4 4 0 1 1 4-4 4 4 0 0 1-4 4M6 8a4 4 0 1 1 4-4 4 4 0 0 1-4 4m17 8h-4.683a1 1 0 0 1-.9-1.43A5.9 5.9 0 0 0 18 12a6 6 0 0 0-.236-1.65 1 1 0 0 1 1.105-1.266A6.02 6.02 0 0 1 24 15a1 1 0 0 1-1 1"})))},k=(0,j.default)(()=>n.e(121).then(n.bind(n,3121)),{loadableGenerated:{webpack:()=>[3121]},ssr:!1}),N=()=>{let{sendAnswerHandler:e,isTouchDevice:t,messages:n,userId:s,usersCount:a}=function(){let[e,t]=(0,r.useState)([]),[n,s]=(0,r.useState)(!1),[a,l]=(0,r.useState)(""),[c,o]=(0,r.useState)(0),u=(0,r.useCallback)(()=>{s(navigator.maxTouchPoints>0)},[]),h=e=>new Promise((t,n)=>{fetch(e.src).then(e=>e.blob()).then(e=>{let s=new FileReader;s.onloadend=()=>t(s.result),s.onerror=n,s.readAsDataURL(e)}).catch(n)}),m=e=>{var n,s,a,c;let r=JSON.parse(e);switch(r.type){case"client_id":l(r.content);break;case"clients_count":o(+r.content);break;case"user_connect":{let e={author:"",content:"Пользователь подключился",timestamp:r.timestamp,type:d.T.SYSTEM};t(t=>[...t,e]);break}case"user_disconnect":{let e={author:"",content:"Пользователь отключился",timestamp:r.timestamp,type:d.T.SYSTEM};t(t=>[...t,e]);break}case"user_audio":{let e={author:null!=(n=r.author)?n:"",content:r.content,timestamp:null!=(s=r.timestamp)?s:0,type:d.T.USER_AUDIO};t(t=>[...t,e]);break}default:{let e={author:null!=(a=r.author)?a:"",content:r.content,timestamp:null!=(c=r.timestamp)?c:0,type:d.T.USER};t(t=>[...t,e])}}},f=(0,r.useCallback)(()=>{i.openConnection("user_chat","wss://chat-ws-ai-server.onrender.com",m)},[]);return(0,r.useEffect)(()=>{u(),f()},[u,f]),{sendAnswerHandler:async e=>{if(!a)return;let t={};if("string"==typeof e)t={author:a,content:e,type:d.T.USER};else if(e instanceof HTMLAudioElement)try{let n=await h(e);t={author:a,content:n,type:d.T.USER_AUDIO}}catch(e){console.log("Ошибка получения url записи",e)}i.sendMessage("user_chat",t)},isTouchDevice:n,messages:e,userId:a,usersCount:c}}();return(0,c.jsx)("div",{className:"h-full overflow-hidden",children:(0,c.jsxs)("div",{className:"h-full relative",children:[(0,c.jsx)("header",{className:"bg-white shadow absolute w-full z-10",children:(0,c.jsxs)("div",{className:"px-4 py-6 sm:px-4 lg:px-6 flex justify-between",children:[(0,c.jsx)("h1",{className:"text-2xl tracking-tight text-gray-900",children:"Chat"}),(0,c.jsxs)("p",{className:"flex gap-2 items-center text-violet-400",children:[(0,c.jsx)("span",{className:"w-6 h-6 flex items-center justify-center",children:(0,c.jsx)(E,{className:"w-full h-full fill-violet-400"})}),a]})]})}),(0,c.jsx)("main",{className:"bg-gray-100 pt-20 h-full",children:(0,c.jsxs)("div",{className:"flex flex-col h-full",children:[(0,c.jsx)("section",{className:"h-max mb-auto overflow-y-auto",children:(0,c.jsx)(v,{messages:n,userId:s})}),(0,c.jsx)("section",{className:"w-full px-4 md:px-0 md:w-7/12 mx-auto z-10",children:(0,c.jsx)(r.Suspense,{fallback:(0,c.jsx)(c.Fragment,{}),children:(0,c.jsx)(k,{sendAnswerHandler:e,isTouchDevice:t})})})]})})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[418,160,441,684,358],()=>t(1387)),_N_E=e.O()}]);